import{B as je,D as Ne,_ as Pe,E as we,F as ke,G as Fe,r as y,A as Ae,k as Ce,a as I,H as Se,j as i,W as ze,L as R,p as L,z as re,t as w,I as Oe,w as ne,x as S,Q as De}from"./index-c796936d.js";import{B as Ee}from"./Button-6feb0bde.js";import{Q as Me}from"./QuantityController-8b9b3139.js";import"./InputNumber-df37bb43.js";var le=Symbol.for("immer-nothing"),se=Symbol.for("immer-draftable"),h=Symbol.for("immer-state");function _(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var j=Object.getPrototypeOf;function N(e){return!!e&&!!e[h]}function b(e){var t;return e?ue(e)||Array.isArray(e)||!!e[se]||!!((t=e.constructor)!=null&&t[se])||E(e)||M(e):!1}var Be=Object.prototype.constructor.toString();function ue(e){if(!e||typeof e!="object")return!1;const t=j(e);if(t===null)return!0;const r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===Be}function k(e,t){D(e)===0?Object.entries(e).forEach(([r,n])=>{t(r,n,e)}):e.forEach((r,n)=>t(n,r,e))}function D(e){const t=e[h];return t?t.type_:Array.isArray(e)?1:E(e)?2:M(e)?3:0}function G(e,t){return D(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function de(e,t,r){const n=D(e);n===2?e.set(t,r):n===3?e.add(r):e[t]=r}function Te(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function E(e){return e instanceof Map}function M(e){return e instanceof Set}function g(e){return e.copy_||e.base_}function K(e,t){if(E(e))return new Map(e);if(M(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);if(!t&&ue(e))return j(e)?{...e}:Object.assign(Object.create(null),e);const r=Object.getOwnPropertyDescriptors(e);delete r[h];let n=Reflect.ownKeys(r);for(let s=0;s<n.length;s++){const a=n[s],o=r[a];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(r[a]={configurable:!0,writable:!0,enumerable:o.enumerable,value:e[a]})}return Object.create(j(e),r)}function Y(e,t=!1){return B(e)||N(e)||!b(e)||(D(e)>1&&(e.set=e.add=e.clear=e.delete=$e),Object.freeze(e),t&&k(e,(r,n)=>Y(n,!0))),e}function $e(){_(2)}function B(e){return Object.isFrozen(e)}var Ie={};function v(e){const t=Ie[e];return t||_(0,e),t}var F;function fe(){return F}function Re(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function ie(e,t){t&&(v("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function H(e){U(e),e.drafts_.forEach(Le),e.drafts_=null}function U(e){e===F&&(F=e.parent_)}function ce(e){return F=Re(F,e)}function Le(e){const t=e[h];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function ae(e,t){t.unfinalizedDrafts_=t.drafts_.length;const r=t.drafts_[0];return e!==void 0&&e!==r?(r[h].modified_&&(H(t),_(4)),b(e)&&(e=z(t,e),t.parent_||O(t,e)),t.patches_&&v("Patches").generateReplacementPatches_(r[h].base_,e,t.patches_,t.inversePatches_)):e=z(t,r,[]),H(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==le?e:void 0}function z(e,t,r){if(B(t))return t;const n=t[h];if(!n)return k(t,(s,a)=>oe(e,n,t,s,a,r)),t;if(n.scope_!==e)return t;if(!n.modified_)return O(e,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const s=n.copy_;let a=s,o=!1;n.type_===3&&(a=new Set(s),s.clear(),o=!0),k(a,(d,f)=>oe(e,n,s,d,f,r,o)),O(e,s,!1),r&&e.patches_&&v("Patches").generatePatches_(n,r,e.patches_,e.inversePatches_)}return n.copy_}function oe(e,t,r,n,s,a,o){if(N(s)){const d=a&&t&&t.type_!==3&&!G(t.assigned_,n)?a.concat(n):void 0,f=z(e,s,d);if(de(r,n,f),N(f))e.canAutoFreeze_=!1;else return}else o&&r.add(s);if(b(s)&&!B(s)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;z(e,s),(!t||!t.scope_.parent_)&&O(e,s)}}function O(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&Y(t,r)}function Qe(e,t){const r=Array.isArray(e),n={type_:r?1:0,scope_:t?t.scope_:fe(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let s=n,a=Z;r&&(s=[n],a=A);const{revoke:o,proxy:d}=Proxy.revocable(s,a);return n.draft_=d,n.revoke_=o,d}var Z={get(e,t){if(t===h)return e;const r=g(e);if(!G(r,t))return We(e,r,t);const n=r[t];return e.finalized_||!b(n)?n:n===Q(e.base_,t)?(W(e),e.copy_[t]=J(n,e)):n},has(e,t){return t in g(e)},ownKeys(e){return Reflect.ownKeys(g(e))},set(e,t,r){const n=he(g(e),t);if(n!=null&&n.set)return n.set.call(e.draft_,r),!0;if(!e.modified_){const s=Q(g(e),t),a=s==null?void 0:s[h];if(a&&a.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(Te(r,s)&&(r!==void 0||G(e.base_,t)))return!0;W(e),X(e)}return e.copy_[t]===r&&(r!==void 0||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty(e,t){return Q(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,W(e),X(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const r=g(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty(){_(11)},getPrototypeOf(e){return j(e.base_)},setPrototypeOf(){_(12)}},A={};k(Z,(e,t)=>{A[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});A.deleteProperty=function(e,t){return A.set.call(this,e,t,void 0)};A.set=function(e,t,r){return Z.set.call(this,e[0],t,r,e[0])};function Q(e,t){const r=e[h];return(r?g(r):e)[t]}function We(e,t,r){var s;const n=he(t,r);return n?"value"in n?n.value:(s=n.get)==null?void 0:s.call(e.draft_):void 0}function he(e,t){if(!(t in e))return;let r=j(e);for(;r;){const n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=j(r)}}function X(e){e.modified_||(e.modified_=!0,e.parent_&&X(e.parent_))}function W(e){e.copy_||(e.copy_=K(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var qe=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,r,n)=>{if(typeof t=="function"&&typeof r!="function"){const a=r;r=t;const o=this;return function(f=a,...p){return o.produce(f,P=>r.call(this,P,...p))}}typeof r!="function"&&_(6),n!==void 0&&typeof n!="function"&&_(7);let s;if(b(t)){const a=ce(this),o=J(t,void 0);let d=!0;try{s=r(o),d=!1}finally{d?H(a):U(a)}return ie(a,n),ae(s,a)}else if(!t||typeof t!="object"){if(s=r(t),s===void 0&&(s=t),s===le&&(s=void 0),this.autoFreeze_&&Y(s,!0),n){const a=[],o=[];v("Patches").generateReplacementPatches_(t,s,a,o),n(a,o)}return s}else _(1,t)},this.produceWithPatches=(t,r)=>{if(typeof t=="function")return(o,...d)=>this.produceWithPatches(o,f=>t(f,...d));let n,s;return[this.produce(t,r,(o,d)=>{n=o,s=d}),n,s]},typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof(e==null?void 0:e.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){b(e)||_(8),N(e)&&(e=Ge(e));const t=ce(this),r=J(e,void 0);return r[h].isManual_=!0,U(t),r}finishDraft(e,t){const r=e&&e[h];(!r||!r.isManual_)&&_(9);const{scope_:n}=r;return ie(n,t),ae(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){const s=t[r];if(s.path.length===0&&s.op==="replace"){e=s.value;break}}r>-1&&(t=t.slice(r+1));const n=v("Patches").applyPatches_;return N(e)?n(e,t):this.produce(e,s=>n(s,t))}};function J(e,t){const r=E(e)?v("MapSet").proxyMap_(e,t):M(e)?v("MapSet").proxySet_(e,t):Qe(e,t);return(t?t.scope_:fe()).drafts_.push(r),r}function Ge(e){return N(e)||_(10,e),me(e)}function me(e){if(!b(e)||B(e))return e;const t=e[h];let r;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=K(e,t.scope_.immer_.useStrictShallowCopy_)}else r=K(e,!0);return k(r,(n,s)=>{de(r,n,me(s))}),t&&(t.finalized_=!1),r}var m=new qe,q=m.produce;m.produceWithPatches.bind(m);m.setAutoFreeze.bind(m);m.setUseStrictShallowCopy.bind(m);m.applyPatches.bind(m);m.createDraft.bind(m);m.finishDraft.bind(m);function Ke(e,t,r,n){for(var s=-1,a=e==null?0:e.length;++s<a;){var o=e[s];t(n,o,r(o),e)}return n}var He=Ke;function Ue(e){return function(t,r,n){for(var s=-1,a=Object(t),o=n(t),d=o.length;d--;){var f=o[e?d:++s];if(r(a[f],f,a)===!1)break}return t}}var Xe=Ue,Je=Xe,Ye=Je(),Ze=Ye,Ve=Ze,et=je;function tt(e,t){return e&&Ve(e,t,et)}var rt=tt,nt=Ne;function st(e,t){return function(r,n){if(r==null)return r;if(!nt(r))return e(r,n);for(var s=r.length,a=t?s:-1,o=Object(r);(t?a--:++a<s)&&n(o[a],a,o)!==!1;);return r}}var it=st,ct=rt,at=it,ot=at(ct),lt=ot,ut=lt;function dt(e,t,r,n){return ut(e,function(s,a,o){t(n,s,r(s),o)}),n}var ft=dt,ht=He,mt=ft,_t=Pe,yt=we;function pt(e,t){return function(r,n){var s=yt(r)?ht:mt,a=t?t():{};return s(r,e,_t(n),a)}}var xt=pt,gt=Fe,bt=xt,vt=bt(function(e,t,r){gt(e,r,t)}),jt=vt;const Nt=ke(jt);function At(){var te;const{extendedPurchases:e,setExtendedPurchases:t}=y.useContext(Ae),{data:r,refetch:n}=Ce({queryKey:["purchases",{status:ne.inCart}],queryFn:()=>S.getPurchaseList({status:ne.inCart})}),s=I({mutationFn:S.updatePurchase,onSuccess:()=>{n()}}),a=I({mutationFn:S.buyProducts,onSuccess:c=>{n(),De.success(c.data.message,{autoClose:1e3,position:"top-center"})}}),o=I({mutationFn:S.deletePurchase,onSuccess:()=>{n()}}),f=(te=Se().state)==null?void 0:te.purchaseId,p=r==null?void 0:r.data.data,P=y.useMemo(()=>e.every(c=>c.checked),[e]),x=y.useMemo(()=>e.filter(c=>c.checked),[e]),V=x.length,_e=y.useMemo(()=>x.reduce((c,l)=>c+l.product.price*l.buy_count,0),[x]),ye=y.useMemo(()=>x.reduce((c,l)=>c+(l.product.price_before_discount-l.product.price)*l.buy_count,0),[x]);y.useEffect(()=>{t(c=>{const l=Nt(c,"_id");return(p==null?void 0:p.map(u=>{var C;const $=f===u._id;return{...u,disabled:!1,checked:$||!!((C=l[u._id])!=null&&C.checked)}}))||[]})},[p,f]),y.useEffect(()=>()=>{history.replaceState(null,"")},[]);const pe=c=>l=>{t(q(u=>{u[c].checked=l.target.checked}))},ee=()=>{t(c=>c.map(l=>({...l,checked:!P})))},T=(c,l,u)=>{if(u){const $=e[c];t(q(C=>{C[c].disabled=!0})),s.mutate({product_id:$.product._id,buy_count:l})}},xe=(c,l)=>{t(q(u=>{u[c].buy_count=l}))},ge=c=>()=>{const l=e[c]._id;o.mutate([l])},be=()=>{const c=x.map(l=>l._id);o.mutate(c)},ve=()=>{if(V>0){const c=x.map(l=>({product_id:l.product._id,buy_count:l.buy_count}));a.mutate(c)}};return i.jsxs("div",{className:"bg-neutral-100 py-16",children:[i.jsxs(ze,{children:[i.jsx("title",{children:" Giỏ hàng | Shopee Clone"}),i.jsx("meta",{name:"description",content:"giỏ hàng dự án shopee clone"})]}),i.jsx("div",{className:"container",children:e.length>0?i.jsxs(y.Fragment,{children:[i.jsx("div",{className:"overflow-auto",children:i.jsxs("div",{className:"min-w-[1000px]",children:[i.jsxs("div",{className:"grid grid-cols-12 rounded-sm bg-white text-sm capitalize text-gray-500 shadow px-9 py-5",children:[i.jsx("div",{className:"col-span-6",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"flex flex-shrink-0 items-center justify-center pr-3",children:i.jsx("input",{type:"checkbox",className:"h5 w-5 accent-orange-600",checked:P,onChange:ee})}),i.jsx("div",{className:"flex-grow text-black",children:"Sản phẩm"})]})}),i.jsx("div",{className:"col-span-6",children:i.jsxs("div",{className:"grid text-center grid-cols-5",children:[i.jsx("div",{className:"col-span-2",children:"Đơn Giá"}),i.jsx("div",{className:"col-span-1",children:"Số Lượng"}),i.jsx("div",{className:"col-span-1",children:"Số Tiền"}),i.jsx("div",{className:"col-span-1",children:"Thao Tác"})]})})]}),e.length>0&&i.jsx("div",{className:"my-3 rounded-sm bg-white p-5 shadow",children:e==null?void 0:e.map((c,l)=>i.jsxs("div",{className:"mt-4 grid grid-cols-12 items-center text-center rounded-sm border border-gray-200 py-5 px-4 text-sm text-gray-500",children:[i.jsx("div",{className:"col-span-6",children:i.jsxs("div",{className:"flex",children:[i.jsx("div",{className:"flex flex-shrink-0 items-center justify-center pr-3",children:i.jsx("input",{type:"checkbox",className:"h5 w-5 accent-orange-600",checked:c.checked,onChange:pe(l)})}),i.jsx("div",{className:"flex-grow",children:i.jsxs("div",{className:"flex",children:[i.jsx(R,{to:`${L.home}${re({name:c.product.name,id:c.product._id})}`,className:"h-20 w-20 flex-shrink-0",children:i.jsx("img",{src:c.product.image,alt:c.product.name})}),i.jsx("div",{className:"flex-grow px-2 pt-1 pb-2 text-left",children:i.jsx(R,{to:`${L.home}${re({name:c.product.name,id:c.product._id})}`,className:"line-clamp-2",children:c.product.name})})]})})]})}),i.jsx("div",{className:"col-span-6",children:i.jsxs("div",{className:"grid grid-cols-5 items-center",children:[i.jsx("div",{className:"col-span-2",children:i.jsxs("div",{className:"flex items-center justify-center",children:[i.jsxs("span",{className:"text-gray-300 line-through ml-3",children:["₫",w(c.product.price_before_discount)]}),i.jsxs("span",{className:"text-gray-500 ml-3",children:["₫",w(c.product.price)]})]})}),i.jsx("div",{className:"col-span-1",children:i.jsx(Me,{max:c.product.quantity,value:c.buy_count,classNameWrapper:"flex items-center",onIncrease:u=>T(l,u,u<=c.product.quantity),onDecrease:u=>T(l,u,u>=1),onType:u=>xe(l,u),disabled:c.disabled,onFocusOut:u=>T(l,u,1<=u&&u<=c.product.quantity&&u!==p[l].buy_count)})}),i.jsx("div",{className:"col-span-1",children:i.jsxs("div",{className:"text-orange-600",children:["₫",w(c.product.price*c.buy_count)]})}),i.jsx("div",{className:"col-span-1",children:i.jsx("button",{className:"bg-none text-black, transition-colors hover:text-orange-600",onClick:ge(l),children:"Xoá"})})]})})]},c._id))})]})}),i.jsxs("div",{className:"sticky bottom-0 z-10 flex items-center rounded-sm bg-white p-5 shadow-sm border-gray-100  sm:flex-row sm:items-center",children:[i.jsx("div",{className:"flex flex-shrink-0 items-center justify-center",children:i.jsx("input",{type:"checkbox",className:"h-5 p-5 accent-orange-600",checked:P,onChange:ee})}),i.jsxs("button",{className:"mx-3 border-none bb-none ",children:["Chọn tất cả (",e.length,")"]}),i.jsx("button",{className:"mx-3 border-none bb-none ",onClick:be,children:"Xóa"}),i.jsxs("div",{className:"mt-5 sm:ml-auto sm:mt-0 sm:flex-row sm:items-center ",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center  sm:justify-end",children:[i.jsxs("div",{children:["Tổng thanh toán (",V," sản phẩm):"]}),i.jsx("div",{className:"ml-2 text-2xl text-orange-500",children:w(_e)})]}),i.jsxs("div",{className:"flex items-center sm:justify-end text-sm",children:[i.jsx("div",{className:"text-gray-500",children:"Tiết kiệm"}),i.jsx("div",{className:"ml-6 text-orange-500",children:w(ye)})]})]}),i.jsx(Ee,{onClick:ve,disabled:a.isLoading,className:"mt-5 h-10 w-52 ml-4 flex justify-center items-center text-center bg-red-500  text-white hover:bg-red-600 sm:ml-4 sm:mt-0 rounded-sm",children:"Mua Hàng"})]})]})]}):i.jsxs("div",{className:"flex flex-col justify-center items-center",children:[i.jsx("div",{className:"",children:i.jsx("img",{src:Oe,className:"overflow-hidden w-40 h-40 ",alt:"no product"})}),i.jsx("div",{className:"text-gray-400 font-bold",children:"Giỏ hàng của bạn còn trống"}),i.jsx("button",{className:"my-4 w-40 uppercase  bg-orange-600 h-10 px-3 rounded-sm text-white hover:bg-orange-600/90",children:i.jsx(R,{to:L.home,children:"Mua Ngay"})})]})})]})}export{At as default};

import{R as B,D as L,S as U,T as R,U as Y,F as G,r as x,j as r,V as q,Q as T,A as Q,u as V,y as H,k as J,a as S,X as K,i as W,W as X,C as F,Y as Z,K as ee}from"./index-c796936d.js";import{u as j}from"./user.api-be1d8a4f.js";import{B as re}from"./Button-6feb0bde.js";import{I as E}from"./Input-1e6aaefa.js";import{I as te}from"./InputNumber-df37bb43.js";var ae=Math.ceil,se=Math.max;function ne(e,t,a,s){for(var o=-1,i=se(ae((t-e)/(a||1)),0),n=Array(i);i--;)n[s?i:++o]=e,e+=a;return n}var ie=ne,oe=B,ce=L,de=U,me=R;function le(e,t,a){if(!me(a))return!1;var s=typeof t;return(s=="number"?ce(a)&&de(t,a.length):s=="string"&&t in a)?oe(a[t],e):!1}var he=le,xe=/\s/;function fe(e){for(var t=e.length;t--&&xe.test(e.charAt(t)););return t}var pe=fe,ge=pe,be=/^\s+/;function ue(e){return e&&e.slice(0,ge(e)+1).replace(be,"")}var je=ue,ye=je,M=R,Ne=Y,A=0/0,we=/^[-+]0x[0-9a-f]+$/i,_e=/^0b[01]+$/i,Ie=/^0o[0-7]+$/i,Ce=parseInt;function Se(e){if(typeof e=="number")return e;if(Ne(e))return A;if(M(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=M(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=ye(e);var a=_e.test(e);return a||Ie.test(e)?Ce(e.slice(2),a?2:8):we.test(e)?A:+e}var Fe=Se,Ee=Fe,D=1/0,Me=17976931348623157e292;function Ae(e){if(!e)return e===0?e:0;if(e=Ee(e),e===D||e===-D){var t=e<0?-1:1;return t*Me}return e===e?e:0}var De=Ae,Re=ie,Te=he,y=De;function ve(e){return function(t,a,s){return s&&typeof s!="number"&&Te(t,a,s)&&(a=s=void 0),t=y(t),a===void 0?(a=t,t=0):a=y(a),s=s===void 0?t<a?1:-1:y(s),Re(t,a,s,e)}}var $e=ve,ke=$e,Pe=ke(),ze=Pe;const N=G(ze);function Oe({value:e,onChange:t,errorMessage:a}){const[s,o]=x.useState({date:(e==null?void 0:e.getDate())||1,month:(e==null?void 0:e.getMonth())||0,year:(e==null?void 0:e.getFullYear())||1990});x.useEffect(()=>{e&&o({date:e==null?void 0:e.getDate(),month:e==null?void 0:e.getMonth(),year:e==null?void 0:e.getFullYear()})},[e]);const i=n=>{const{value:f,name:b}=n.target,c={date:(e==null?void 0:e.getDate())||s.date,month:(e==null?void 0:e.getMonth())||s.month,year:(e==null?void 0:e.getFullYear())||s.year,[b]:Number(f)};t&&t(new Date(c.year,c.month,c.date))};return r.jsxs("div",{className:"mt-2 flex flex-col flex-wrap sm:flex-row",children:[r.jsx("div",{className:"truncate pt-3 capitalize sm:w-[20%] sm:text-right",children:"Ngày sinh"}),r.jsxs("div",{className:"sm:w-[80%] sm:pl-5",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsxs("select",{onChange:i,name:"date",className:"h-10 w-[32%] cursor-pointer rounded-sm border border-black/10 px-3 hover:border-orange-500",value:(e==null?void 0:e.getDate())||s.date,children:[r.jsx("option",{disabled:!0,children:"Ngày"}),N(1,32).map(n=>r.jsx("option",{value:n,children:n},n))]}),r.jsxs("select",{onChange:i,name:"month",className:"h-10 w-[32%] cursor-pointer rounded-sm border border-black/10 px-3 hover:border-orange-500 ",value:(e==null?void 0:e.getMonth())||s.month,children:[r.jsx("option",{disabled:!0,children:"Tháng"}),N(0,12).map(n=>r.jsx("option",{value:n,children:n+1},n))]}),r.jsxs("select",{onChange:i,name:"year",className:"h-10 w-[32%] cursor-pointer rounded-sm border border-black/10 px-3 hover:border-orange-500 ",value:(e==null?void 0:e.getFullYear())||s.year,children:[r.jsx("option",{disabled:!0,children:"Năm"}),N(1990,2024).map(n=>r.jsx("option",{value:n,children:n},n))]})]}),r.jsx("div",{className:"mt-1 min-h-[1.25rem] text-sm text-red-600",children:a})]})]})}function Be({onChange:e}){const t=x.useRef(null),a=o=>{var n;const i=(n=o.target.files)==null?void 0:n[0];i&&i.size>=q.maxSizeUploadAvatar?T.error("Dụng lượng file tối đa 1MB Định dạng:.JPEG, .PNG",{position:"top-center"}):e&&e(i)},s=()=>{var o;(o=t.current)==null||o.click()};return r.jsxs("div",{children:[r.jsx("input",{type:"file",name:"avatar",accept:".jpg, .png, .jpeg",className:"hidden",ref:t,onChange:a,onClick:o=>{o.target.value=null}}),r.jsx("button",{type:"button",onClick:s,className:" border border-gray-200 bg-white px-6  py-2 text-sm text-gray-600",children:"Chọn Ảnh"})]})}const Le=ee.pick(["name","phone","address","date_of_birth","avatar"]);function Ve(){var _,I;const{setProfile:e}=x.useContext(Q),[t,a]=x.useState(),s=x.useMemo(()=>t?URL.createObjectURL(t):"",[t]),{control:o,register:i,watch:n,formState:{errors:f},handleSubmit:b,setValue:c,setError:v}=V({defaultValues:{name:"",phone:"",address:"",avatar:"",date_of_birth:new Date(1990,0,1)},resolver:H(Le)}),{data:u}=J({queryKey:["profile"],queryFn:j.getProfile}),$=S({mutationFn:j.updateProfile}),k=S({mutationFn:j.uploadAvatar}),d=u==null?void 0:u.data.data,w=n("avatar");x.useEffect(()=>{d&&(c("name",d.name),c("phone",d.phone),c("address",d.address),c("avatar",d.avatar),c("date_of_birth",d.date_of_birth?new Date(d.date_of_birth):new Date))},[d,c]);const P=b(async m=>{var l,C;try{let p=w;if(t){const g=new FormData;g.append("image",t);const O=await k.mutateAsync(g);p=String(O.data.data),c("avatar",p)}const h=await $.mutateAsync({...m,date_of_birth:(l=m.date_of_birth)==null?void 0:l.toISOString(),avatar:p});e(h.data.data),K(h.data.data),T.success(h.data.message,{position:"top-center",autoClose:1e3})}catch(p){if(W(p)){const h=(C=p.response)==null?void 0:C.data.data;h&&Object.keys(h).forEach(g=>{v(g,{message:h[g],type:"Server"})})}}}),z=m=>{a(m)};return r.jsxs("div",{className:"rounded-sm bg-white px-2 md:px-7 pb-10 md:pb-20 shadow",children:[r.jsxs(X,{children:[r.jsx("title",{children:"Trang cá nhân | Shopee Clone"}),r.jsx("meta",{name:"description",content:"trang cá nhân dự án shopee clone"})]}),r.jsxs("div",{className:"border-b border-b-gray-200 py-4",children:[r.jsx("h1",{className:"text-gray-900 text-lg font-medium capitalize px-10",children:"Hồ Sơ Của Tôi"}),r.jsx("p",{className:"text-gray-700 text-sm mt-1 px-10",children:"Quản lý trang thông tin hồ sơ để bảo vệ tài khoản"})]}),r.jsxs("div",{className:"mt-8 flex flex-col-reverse md:flex-row md:items-start",children:[r.jsxs("form",{className:"flex-grow mt-6 pr-12 md:mt-0",onSubmit:P,children:[r.jsxs("div",{className:"flex flex-wrap sm:flex-row",children:[r.jsx("div",{className:"sm:w-[20%] truncate pt-3 sm:text-right capitalize",children:"Email"}),r.jsx("div",{className:"sm:w-[80%] pl-5",children:r.jsx("div",{className:"pt-3 text-gray-700",children:d==null?void 0:d.email})})]}),r.jsxs("div",{className:"flex flex-wrap mt-6  sm:flex-row",children:[r.jsx("div",{className:"sm:w-[20%] truncate pt-3 sm:text-right capitalize",children:"Tên"}),r.jsx("div",{className:"sm:w-[80%] pl-5",children:r.jsx(E,{classNameInput:"w-full rounded-sm border border-gray-300 px-3 py-2 outline-none focus:border-gray-500 focus:shadow-sm",register:i,placeholder:"Tên",name:"name",errorMassage:(_=f.name)==null?void 0:_.message})})]}),r.jsxs("div",{className:"flex flex-wrap mt-2  sm:flex-row",children:[r.jsx("div",{className:"sm:w-[20%] truncate pt-3 sm:text-right capitalize",children:"Số điện thoại"}),r.jsx("div",{className:"sm:w-[80%] pl-5",children:r.jsx(F,{control:o,name:"phone",render:({field:m})=>{var l;return r.jsx(te,{classNameInput:"w-full rounded-sm border border-gray-300 px-3 py-2 outline-none focus:border-gray-500 focus:shadow-sm",placeholder:"Số Điện Thoại",errorMassage:(l=f.phone)==null?void 0:l.message,...m,onChange:m.onChange})}})})]}),r.jsxs("div",{className:"flex flex-wrap mt-2  sm:flex-row",children:[r.jsx("div",{className:"sm:w-[20%] truncate pt-3 sm:text-right capitalize",children:"Địa chỉ"}),r.jsx("div",{className:"sm:w-[80%] pl-5",children:r.jsx(E,{classNameInput:"w-full rounded-sm border border-gray-300 px-3 py-2 outline-none focus:border-gray-500 focus:shadow-sm",register:i,placeholder:"Địa chỉ",name:"address",errorMassage:(I=f.name)==null?void 0:I.message})})]}),r.jsx(F,{control:o,name:"date_of_birth",render:({field:m})=>{var l;return r.jsx(Oe,{errorMessage:(l=f.date_of_birth)==null?void 0:l.message,onChange:m.onChange,value:m.value})}}),r.jsxs("div",{className:"flex flex-wrap mt-5 sm:flex-row",children:[r.jsx("div",{className:"sm:w-[20%] truncate pt-3 sm:text-right capitalize"}),r.jsx("div",{className:"sm:w-[80%] pl-5 ",children:r.jsx(re,{type:"submit",className:"sm:w-[30%] md:w-[50px] text-center bg-orange-600 py-2 px-2 text-white  hover:bg-orange-600/80 rounded-sm",children:"Lưu"})})]})]}),r.jsx("div",{className:"flex justify-center md:w-72 md:border-l md:border-l-gray-200",children:r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx("div",{className:"my-5 h-24 w-24",children:r.jsx("img",{src:s||Z(w),alt:"avatar",className:"w-full h-full object-cover rounded-full"})}),r.jsx(Be,{onChange:z}),r.jsx("div",{className:"text-center mt-2 text-gray-400",children:"Dụng lượng file tối đa 1 MB "}),r.jsx("div",{className:"text-center mt-2 text-gray-400",children:"Định dạng:.JPEG, .PNG"})]})})]})]})}export{Ve as default};
